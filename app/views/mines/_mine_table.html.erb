<div id="data-table">
  <%= paginate @mines if !search %>
  <table class="table table-striped table-hover table-condensed" id="mine-table">
  <br/>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Typ</th>
        <th>Beschreibung</th>
        <th>Gesperrt</th>
        <th>Bilder</th>
        <th>Zustand</th>        
        <th>Besucht</th>
        <th></th> 
      </tr>
    </thead>

    <tbody>
      <% mines.each do |mine| %>
        <tr id="mine-row-<%=mine.id.to_s%>" <%= 'class=warning' if !mine.locked_by.nil? %> >
          <td><%= mine.id.to_s %></td>
          <td><%= mine.name.first(30) %></td>
          <td><%= sort_of_text(mine.sort) %></td>
          <td><%= mine.description.first(25) if mine.description %></td>
          <td><% if !mine.locked_by.nil? %><%= mine.user.email %><%end%></td>
          <td><span class="badge"><%= mine.photos.count.to_s %></span></td>
          <td><%= state_to_desc(mine.state) %></td>
          <td><%= mine.visited_at.strftime("%d.%m.%Y") if mine.visited_at %></td>
          <td>
          <% if current_user.is_admin? %>  
            <% if mine.locked_by.nil? or mine.locked_by == current_user.id %>            
              <%= link_to 'Edit', edit_mine_path(mine), class: "btn btn-primary btn-xs", remote: true %>
            <% end %>
              <%= link_to 'Show', mine_path(mine), class: "btn btn-success btn-xs" %>
            <% if mine.locked_by.nil? or mine.locked_by == current_user.id %>            
              <%= link_to 'Delete', mine, method: :delete, remote: true,data: { confirm: 'Bist du sicher?'},class: "btn btn-danger btn-xs" %>
            <% end %>
            <% if mine.locked_by == current_user.id %>
              <%= link_to 'Unlock', unlock_mine_path(mine), method: :post, remote: true, class: "btn btn-warning btn-xs" %>            
            <% end %>
            <% if mine.locked_by.nil? %>
              <%= link_to 'Lock', lock_mine_path(mine), method: :post, remote: true, class: "btn btn-warning btn-xs" %>            
            <% end %>
          <% end %>
          </td>  
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<script>
  /*$(document).ready(function(){
    $('#mine-table').DataTable();
  });*/
</script>