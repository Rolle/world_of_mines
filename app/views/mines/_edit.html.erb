<div class="modal fade" id="popup-mine-edit">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title"><%= mine.name %></h4>
      </div>
      <div class="modal-body">
        <%= form_tag(url_for(controller: 'mines', action: :updateajax, id: mine.id, format: :js), method: :post, remote: true) do %>
          <div class="form-group">
            <%= label_tag "Name", nil, :class => "control-label" %>
            <div class="controls">
                <%= text_field_tag :name, mine.name, {:class=>"input-small form-control"} %>
            </div>
          </div>
          <div class="form-group">
            <%= label_tag "Beschreibung", nil, :class => "control-label" %>
            <div class="controls">
                <%= text_area_tag :description, mine.description, {:class=>"input-small form-control"} %>
            </div>
          </div>
          <div class="form-group">
            <div id ="map" style="width:566px; height: 200px;"></div>         
          </div>
          <% if current_user.is_admin? %>
            <%= button_tag( :class => "btn btn-primary btn-sm") do %>
              <i class="glyphicon glyphicon-save"></i> Speichern
            <% end %>
          <% end %>
        <% end %>
      </div>

    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false"></script>

<script type='text/javascript'>   
    var markersObject = {};

    <% if Rails.env.production? %>
            L.Icon.Default.imagePath = '/';
    <% else %>
            L.Icon.Default.imagePath = '<%= asset_path "" %>';
    <% end %>
    var redMarker = L.AwesomeMarkers.icon({
              icon: 'search', 
              markerColor: 'red',
              prefix: 'fa'
    })

    map = new L.Map('map');
    map.setView(new L.LatLng(<%=mine.latitude%>,<%=mine.longitude%>), 12);

    var osmde = L.tileLayer.provider('OpenStreetMap.DE');
    //var ggl = new L.Google();
    var bing = new L.BingLayer("ApiJPrwDWWqUlXoy7gg460DQBa55V-i1XqWWQfnf1sz5HW4CfxUkBZ7afjaMtQ5W");
    
    var baseMaps = {
            //"Google": ggl,
            "Bing": bing,
            "OSM DE": osmde,
    };
    var markers_main = new L.LayerGroup();
    var overlayMaps = {
        "Gruben": markers_main,
    };
    L.control.layers(baseMaps, overlayMaps).addTo(map);
    //map.addLayer(bing);
    map.addLayer(osmde);
    map.addLayer(markers_main);
    //map.addLayer(baseMaps);
    
    
    marker = L.marker([<%= mine.latitude %>, <%= mine.longitude %>], {icon: redMarker, title: '<%=mine.name %>'}).addTo(map);
    $('#popup-mine-edit').on('shown.bs.modal', function(){
      setTimeout(function() {
      map.invalidateSize();
      }, 10);
    });
  $('#popup-mine-edit').modal('show');
  map.invalidateSize();
</script>